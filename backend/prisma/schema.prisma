generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  demoCredits  Json     // { sora: number, gemini: number, bannerbear: number }
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Authentication
  isVerified   Boolean  @default(false)
  lastLoginAt  DateTime?
  
  // Relations
  posts       Post[]
  brandConfig BrandConfig?
  roiMetrics  ROIMetrics?
  sessions    Session[]
  
  @@map("users")
}

model Post {
  id            String     @id @default(cuid())
  prompt        String
  script        Json       // { caption: string[], cta: string, mediaType: string, imageReference: string }
  platform      Platform   @default(INSTAGRAM)
  status        PostStatus @default(NEW)
  mediaType     MediaType?
  mediaUrl      String?
  mediaProvider String?    // "sora", "gemini", "bannerbear"
  bufferPostId  String?    // Buffer post ID for tracking
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("posts")
}

model BrandConfig {
  id             String   @id @default(cuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyName    String
  logoUrl        String?
  primaryColor   String   @default("#3B82F6")
  secondaryColor String   @default("#1E40AF")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  @@map("brand_configs")
}

model ROIMetrics {
  id             String   @id @default(cuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  postsCreated   Int      @default(0)
  timeSaved      Int      @default(0) // in minutes
  mediaGenerated Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  @@map("roi_metrics")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  @@map("sessions")
}

enum Platform {
  INSTAGRAM
  LINKEDIN
  FACEBOOK
  TWITTER
}

enum PostStatus {
  NEW
  PROCESSING
  READY
  FAILED
  PUBLISHED
}

enum MediaType {
  VIDEO
  IMAGE
  CAROUSEL
}